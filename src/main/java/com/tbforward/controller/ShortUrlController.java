package com.tbforward.controller;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.beans.factory.annotation.Qualifier;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.PathVariable;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import com.tbforward.beans.JsonData;import com.tbforward.beans.ShortUrl;import com.tbforward.exception.ServiceException;import com.tbforward.service.ShortUrlGenerateService;import com.tbforward.utils.TaobaoUtil;@Controllerpublic class ShortUrlController {		@Autowired	@Qualifier("localShortUrl")	private ShortUrlGenerateService localShortUrlService;		@Autowired	@Qualifier("sinaShortUrl")	private ShortUrlGenerateService sinaShortUrlService;	    @ResponseBody    @RequestMapping(value="/gen", method=RequestMethod.POST)    public JsonData generate(@RequestBody String url) throws ServiceException {    	String toGen = TaobaoUtil.converter(url);    	    	if (toGen == null) {    		throw new ServiceException("Taobao/Tmall url is not valid.");    	}    	ShortUrl shortUrl = localShortUrlService.generate(toGen);        return JsonData.success(shortUrl);    }        @ResponseBody    @RequestMapping("/code/{code}")    public JsonData retieve(@PathVariable String code) {    	ShortUrl shortUrl = localShortUrlService.getByCode(code);        return JsonData.success(shortUrl);    }        @ResponseBody    @RequestMapping("/sinagen")    public JsonData sinaGenerate(@RequestParam("url") String url) {    	ShortUrl result = sinaShortUrlService.generate(url);        return JsonData.success(result);    }//    @RequestMapping("/t/{url}")//    public void toOrigin(@PathVariable("url") String url, HttpServletResponse response) {//        try {//            response.sendRedirect(shortUrlService.getOriginUrlWithoutException(url));//        } catch (Throwable t) {//            log.error("根据短链接跳转出现异常, url=" + url, t);//        }//    }}